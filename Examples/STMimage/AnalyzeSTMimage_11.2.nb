(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[     28546,        629]
NotebookOptionsPosition[     27704,        604]
NotebookOutlinePosition[     28142,        621]
CellTagsIndexPosition[     28099,        618]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fn", "=", "\"\</path/to/STMimage.nc\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"STMimage", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"fn", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Data\>\"", ",", "\"\<STMimage\>\""}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"theta", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"fn", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Data\>\"", ",", "\"\<theta\>\""}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Nx", "=", 
   RowBox[{"Length", "@", 
    RowBox[{"STMimage", "[", 
     RowBox[{"[", 
      RowBox[{";;", ",", "1"}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ny", "=", 
    RowBox[{"Length", "@", 
     RowBox[{"STMimage", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", ";;"}], "]"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  "\"\<STM image (Siesta tip position centered at image):\>\"", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", 
        RowBox[{"Cos", "[", "theta", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"matTransf", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ".", 
        RowBox[{"{", 
         RowBox[{"ii", ",", "jj"}], "}"}]}], ",", 
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ".", 
        RowBox[{"{", 
         RowBox[{"ii", ",", "jj"}], "}"}]}], ",", 
       RowBox[{"STMimage", "[", 
        RowBox[{"[", 
         RowBox[{"ii", ",", 
          RowBox[{"Ny", "+", "1", "-", "jj"}]}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "1", ",", "Nx"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"jj", ",", "1", ",", "Ny"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Rotate", "[", 
   RowBox[{
    RowBox[{"ListContourPlot", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"matTransf", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "]"}], ",", 
      RowBox[{"AspectRatio", "\[Rule]", 
       RowBox[{"1", "+", 
        RowBox[{"Cos", "[", "theta", "]"}]}]}], ",", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
      RowBox[{"ColorFunction", "\[Rule]", "\"\<DeepSeaColors\>\""}], ",", 
      RowBox[{"Mesh", "\[Rule]", "False"}], ",", 
      RowBox[{"Frame", "\[Rule]", "False"}], ",", 
      RowBox[{"Contours", "\[Rule]", "20"}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "200"}]}], "]"}], ",", 
    RowBox[{"270", " ", "Degree"}]}], "]"}], "\n"}], "\n", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Minimum conductance: \>\"", ",", 
   RowBox[{"Min", "[", "STMimage", "]"}], ",", "\"\< nA/V\>\""}], "]"}], "\n", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Maximum conductance: \>\"", ",", 
   RowBox[{"Max", "[", "STMimage", "]"}], ",", "\"\< nA/V\>\""}], "]"}], "\n", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Min/max ratio      : \>\"", ",", 
   RowBox[{
    RowBox[{"Min", "[", "STMimage", "]"}], "/", 
    RowBox[{"Max", "[", "STMimage", "]"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.726822785896117*^9, 3.726822785897688*^9}, {
   3.726822833104281*^9, 3.7268228333152113`*^9}, {3.726822976715893*^9, 
   3.726823009195509*^9}, {3.726830420671858*^9, 3.7268304209074306`*^9}, 
   3.726831026548335*^9, {3.726893496761565*^9, 3.726893524889207*^9}, {
   3.726896788122958*^9, 3.726896790586626*^9}, {3.726897758869934*^9, 
   3.7268977660849543`*^9}, {3.726898237987822*^9, 3.726898239018692*^9}, {
   3.726898509447135*^9, 3.726898510661991*^9}, {3.726901077493065*^9, 
   3.726901098379332*^9}, {3.726901270568462*^9, 3.7269012714880342`*^9}, {
   3.726901436987794*^9, 3.726901437952882*^9}, {3.7269135331996307`*^9, 
   3.726913535432376*^9}, {3.72691363245465*^9, 3.726913673962113*^9}, {
   3.726913744005582*^9, 3.726913749162796*^9}, {3.726913848424591*^9, 
   3.726913849568472*^9}, {3.7269139257006893`*^9, 3.726913941998412*^9}, {
   3.727158852835738*^9, 3.727158854352214*^9}, {3.727159019389189*^9, 
   3.727159037723833*^9}, {3.727159281867082*^9, 3.7271592838466997`*^9}, {
   3.72716385595505*^9, 3.727163861071941*^9}, {3.7271640020237913`*^9, 
   3.72716400310073*^9}, {3.727164205385915*^9, 3.727164207006116*^9}, {
   3.7271644345514174`*^9, 3.7271645051647043`*^9}, {3.727164603543868*^9, 
   3.727164652432374*^9}, {3.727166728723822*^9, 3.727166731658209*^9}, {
   3.727167118459528*^9, 3.727167119665431*^9}, {3.727167216846026*^9, 
   3.727167230972636*^9}, {3.727168044064918*^9, 3.727168046587412*^9}, {
   3.727168333536283*^9, 3.7271683348547583`*^9}, {3.727168481245236*^9, 
   3.727168497121697*^9}, {3.727170417436467*^9, 3.727170418538377*^9}, {
   3.7271729434881277`*^9, 3.72717294463105*^9}, {3.727174112535245*^9, 
   3.727174112711293*^9}, {3.727174226188642*^9, 3.7271742273564243`*^9}, {
   3.727175790093783*^9, 3.727175791242453*^9}, {3.727411546843999*^9, 
   3.7274115479930696`*^9}, {3.727411627402789*^9, 3.727411630212172*^9}, {
   3.727411756303769*^9, 3.727411757433971*^9}, {3.727428024166442*^9, 
   3.727428028949564*^9}, {3.727432763052827*^9, 3.72743276402092*^9}, {
   3.72743288764998*^9, 3.727432888727584*^9}, {3.7274363770944777`*^9, 
   3.727436380934222*^9}, 3.727436491503584*^9, {3.727437444770906*^9, 
   3.7274374457236557`*^9}, 3.727437500140499*^9, {3.7275157708800917`*^9, 
   3.727515775029242*^9}, {3.727518866498259*^9, 3.7275188690805387`*^9}, {
   3.727519100365038*^9, 3.727519124402439*^9}, {3.727519284952055*^9, 
   3.727519293180579*^9}, {3.727519701630623*^9, 3.727519704253594*^9}, {
   3.7275259772294493`*^9, 3.727526015746437*^9}, {3.727541110198483*^9, 
   3.727541113324066*^9}, {3.727541367285324*^9, 3.727541403736485*^9}, {
   3.7275849289770412`*^9, 3.727584958407024*^9}, {3.727676224555153*^9, 
   3.727676224771723*^9}, {3.727676301996517*^9, 3.72767631153195*^9}, {
   3.727678717689802*^9, 3.727678723207506*^9}, {3.7276846791170263`*^9, 
   3.727684694228902*^9}, {3.727685662959833*^9, 3.727685665606514*^9}, {
   3.727685839524643*^9, 3.7276858407548933`*^9}, {3.727686061377226*^9, 
   3.7276860667826777`*^9}, {3.727688104570863*^9, 3.727688132565639*^9}, {
   3.727688199471143*^9, 3.727688203151754*^9}, {3.72768866628128*^9, 
   3.727688667767951*^9}, {3.727688780982389*^9, 3.727688782137205*^9}, {
   3.727689219640368*^9, 3.727689254289819*^9}, {3.727689368430841*^9, 
   3.7276893970228786`*^9}, {3.727689517370015*^9, 3.727689518424996*^9}, {
   3.727689599657524*^9, 3.727689647687204*^9}, {3.727689972253785*^9, 
   3.727689972434269*^9}, {3.72769016392525*^9, 3.727690171936099*^9}, {
   3.7276902600492287`*^9, 3.727690261136856*^9}, {3.7276904013408833`*^9, 
   3.727690404034977*^9}, {3.72769045903992*^9, 3.727690472269436*^9}, {
   3.727690511124318*^9, 3.727690520465557*^9}, {3.727690666811639*^9, 
   3.727690674032689*^9}, {3.727690885905456*^9, 3.7276909269066887`*^9}, {
   3.7276960204270153`*^9, 3.727696065128954*^9}, {3.7277576964221497`*^9, 
   3.7277577227110977`*^9}, {3.7277594374392853`*^9, 3.727759468705654*^9}, {
   3.727759588875784*^9, 3.727759615010895*^9}, {3.727759645996932*^9, 
   3.7277596478825283`*^9}, {3.7277597173531933`*^9, 
   3.7277597175883636`*^9}, {3.727759860911625*^9, 3.7277598625249853`*^9}, {
   3.727759900575118*^9, 3.727759900691965*^9}, {3.7277601979036007`*^9, 
   3.727760199045416*^9}, {3.72776106229895*^9, 3.727761062667245*^9}, {
   3.727761121764436*^9, 3.727761122924506*^9}, {3.727761241183935*^9, 
   3.727761257445863*^9}, {3.7277613200372066`*^9, 3.7277614577696943`*^9}, {
   3.727761970505278*^9, 3.727762007910083*^9}, {3.72776231519127*^9, 
   3.7277623374868383`*^9}, {3.727762530591198*^9, 3.72776253070087*^9}, {
   3.727763043857032*^9, 3.727763045362561*^9}, {3.727763251724394*^9, 
   3.727763252914905*^9}, {3.727763339632676*^9, 3.727763340168358*^9}, {
   3.727763921461692*^9, 3.727763924755754*^9}, {3.727764126809433*^9, 
   3.7277641608547583`*^9}, {3.7277642691332827`*^9, 
   3.7277642707480097`*^9}, {3.727765475179188*^9, 3.727765475733645*^9}, {
   3.727766171514476*^9, 3.727766177242838*^9}, {3.727766330366349*^9, 
   3.727766353763077*^9}, {3.727766398702037*^9, 3.727766413337009*^9}, {
   3.727766512883638*^9, 3.727766518258322*^9}, {3.728020188496296*^9, 
   3.728020205060464*^9}, {3.72802029172983*^9, 3.7280203741271267`*^9}, 
   3.728020420292162*^9, {3.728020519078269*^9, 3.7280205201160507`*^9}, {
   3.728195207543105*^9, 3.728195213084099*^9}, {3.728195318409504*^9, 
   3.728195327211176*^9}, {3.728196628951418*^9, 3.7281966361734447`*^9}, {
   3.729409621567857*^9, 3.729409629551526*^9}, {3.7350374101348667`*^9, 
   3.7350374463002863`*^9}, {3.73503752473589*^9, 3.7350375350115957`*^9}, {
   3.7350375988463697`*^9, 3.735037600710416*^9}, {3.735037714347418*^9, 
   3.735037727458495*^9}, {3.735037920484745*^9, 3.735037937002488*^9}, {
   3.735039394481489*^9, 
   3.735039415502726*^9}},ExpressionUUID->"c3f8fcf5-276d-49fe-930e-\
80bf6021b3fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Check", " ", "inversion", " ", "symmetry"}], ",", "etc", ",", 
    " ", 
    RowBox[{"in", " ", "1", 
     RowBox[{"BZ", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"kpoints", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"fn", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Data\>\"", ",", "\"\<kpoints\>\""}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k1", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"fn", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Data\>\"", ",", "\"\<Nk1\>\""}], "}"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k2", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"fn", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Data\>\"", ",", "\"\<Nk2\>\""}], "}"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"STMkpoints", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"fn", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Data\>\"", ",", "\"\<STMkpoint\>\""}], "}"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.726826823439157*^9, {3.726829519322863*^9, 3.726829547480811*^9}, {
   3.726829829130208*^9, 3.726829835573401*^9}, {3.726829940387783*^9, 
   3.726829942702139*^9}, {3.726830027036726*^9, 3.726830040521883*^9}, {
   3.726830090043777*^9, 3.726830093832855*^9}, {3.726830187295005*^9, 
   3.7268301887431793`*^9}, {3.7268935390859833`*^9, 3.726893628276919*^9}, {
   3.727432914764905*^9, 3.727432925161058*^9}, 3.7274375073631983`*^9, {
   3.727679374086959*^9, 3.727679394303378*^9}, {3.7276795128410473`*^9, 
   3.727679538820269*^9}, {3.7276796316075687`*^9, 3.7276796357466097`*^9}, {
   3.727679742192006*^9, 3.727679748842669*^9}, 3.727679876993269*^9, {
   3.727679913422616*^9, 3.727679914996911*^9}, {3.727680212637845*^9, 
   3.727680213675261*^9}, {3.7276825676454887`*^9, 3.7276825677682867`*^9}, {
   3.727682972675757*^9, 3.727682974921619*^9}, {3.727683633248933*^9, 
   3.727683717167097*^9}, {3.727683756027295*^9, 3.727683807206688*^9}, {
   3.72768421140137*^9, 3.727684281993417*^9}, {3.727684350004506*^9, 
   3.727684529728881*^9}, {3.727684708088524*^9, 3.727684708382598*^9}, {
   3.727684753854097*^9, 3.7276847599622593`*^9}, {3.727685540576168*^9, 
   3.7276855412566442`*^9}, {3.727685703702217*^9, 3.727685704259094*^9}, {
   3.727685794931233*^9, 3.7276858638714542`*^9}, {3.727686124267973*^9, 
   3.7276861335544662`*^9}, {3.727687078113997*^9, 3.727687084559661*^9}, {
   3.727689410238901*^9, 3.727689459535637*^9}, {3.7276894931297083`*^9, 
   3.7276895400318403`*^9}, {3.7276897285521297`*^9, 3.7276897288068867`*^9}, 
   3.727690078949028*^9, {3.7276902852391663`*^9, 3.7276903046746273`*^9}, {
   3.7276907076839247`*^9, 3.727690714841157*^9}, {3.727690939309491*^9, 
   3.727690953929633*^9}, {3.727696088535955*^9, 3.727696088749699*^9}, {
   3.727757773268188*^9, 3.727757823701589*^9}, {3.727757881245099*^9, 
   3.727757882293539*^9}, {3.727759491482584*^9, 3.7277594916739388`*^9}, {
   3.727762364661405*^9, 3.727762432149131*^9}, {3.727762603039462*^9, 
   3.72776260343296*^9}, {3.727762648264073*^9, 3.727762650030171*^9}, {
   3.727762695521236*^9, 3.727762728128439*^9}, {3.727762778303732*^9, 
   3.727762875052683*^9}, {3.727765532008542*^9, 3.7277655322712183`*^9}, {
   3.7277659655348063`*^9, 3.727766006795479*^9}, {3.7280204370225573`*^9, 
   3.728020441664113*^9}, {3.735037878172394*^9, 3.735037885469323*^9}, {
   3.735037968871964*^9, 3.7350379903883123`*^9}, {3.735038122783827*^9, 
   3.735038149172048*^9}},ExpressionUUID->"d190b6bb-9a2c-4cf8-aa45-\
75db52447435"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tmp", "=", 
   RowBox[{"ListInterpolation", "[", "STMkpoints", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"size", "=", 
   RowBox[{"Dimensions", "[", "STMkpoints", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nx", "=", 
   RowBox[{"size", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
  RowBox[{"ny", "=", 
   RowBox[{"size", "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"k1", ">", "4"}], ",", 
    RowBox[{"res", "=", "2"}], ",", 
    RowBox[{"res", "=", "1"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ptsx", "=", 
   RowBox[{"res", " ", 
    RowBox[{"nx", "/", "k1"}]}]}], ";", 
  RowBox[{"ptsy", "=", 
   RowBox[{"res", " ", 
    RowBox[{"ny", "/", "k2"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"STMkpoints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"tmp", "[", 
      RowBox[{
       RowBox[{"ii", " ", 
        RowBox[{"nx", "/", "ptsx"}]}], ",", 
       RowBox[{"jj", " ", 
        RowBox[{"ny", "/", "ptsy"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "ptsx"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"jj", ",", "ptsy"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Number of k points along a1: \>\"", ",", "k1"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Number of k points along a2: \>\"", ",", "k2"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", "\"\<STM images of individual k points:\>\"", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", 
        RowBox[{"Cos", "[", "theta", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"matTransf", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ".", 
        RowBox[{"{", 
         RowBox[{"ii", ",", "jj"}], "}"}]}], ",", 
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ".", 
        RowBox[{"{", 
         RowBox[{"ii", ",", "jj"}], "}"}]}], ",", 
       RowBox[{"STMkpoints", "[", 
        RowBox[{"[", 
         RowBox[{"ii", ",", "jj"}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "1", ",", "ptsx"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"jj", ",", "1", ",", "ptsy"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"Rotate", "[", 
  RowBox[{
   RowBox[{"ListDensityPlot", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"matTransf", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]}], "]"}], ",", 
     RowBox[{"AspectRatio", "\[Rule]", 
      RowBox[{"1", "+", 
       RowBox[{"Cos", "[", "theta", "]"}]}]}], ",", 
     RowBox[{"ColorFunction", "\[Rule]", "\"\<DeepSeaColors\>\""}], ",", 
     RowBox[{"Mesh", "\[Rule]", "False"}], ",", 
     RowBox[{"Frame", "\[Rule]", "False"}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "200"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Min", "@", "STMkpoints"}], ",", 
        RowBox[{"Max", "@", "STMkpoints"}]}], "}"}]}]}], "]"}], ",", 
   RowBox[{"270", " ", "Degree"}]}], "]"}]}], "Input",
 CellChangeTimes->{
  3.726826823439157*^9, {3.726829519322863*^9, 3.726829547480811*^9}, {
   3.726829829130208*^9, 3.726829835573401*^9}, {3.726829940387783*^9, 
   3.726829942702139*^9}, {3.726830027036726*^9, 3.726830040521883*^9}, {
   3.726830090043777*^9, 3.726830093832855*^9}, {3.726830187295005*^9, 
   3.7268301887431793`*^9}, {3.7268935390859833`*^9, 3.726893628276919*^9}, {
   3.727432914764905*^9, 3.727432925161058*^9}, 3.7274375073631983`*^9, {
   3.727679374086959*^9, 3.727679394303378*^9}, {3.7276795128410473`*^9, 
   3.727679538820269*^9}, {3.7276796316075687`*^9, 3.7276796357466097`*^9}, {
   3.727679742192006*^9, 3.727679748842669*^9}, 3.727679876993269*^9, {
   3.727679913422616*^9, 3.727679914996911*^9}, {3.727680212637845*^9, 
   3.727680213675261*^9}, {3.7276825676454887`*^9, 3.7276825677682867`*^9}, {
   3.727682972675757*^9, 3.727682974921619*^9}, {3.727683633248933*^9, 
   3.727683717167097*^9}, {3.727683756027295*^9, 3.727683807206688*^9}, {
   3.72768421140137*^9, 3.727684281993417*^9}, {3.727684350004506*^9, 
   3.727684529728881*^9}, {3.727684708088524*^9, 3.727684708382598*^9}, {
   3.727684753854097*^9, 3.7276847599622593`*^9}, {3.727685540576168*^9, 
   3.7276855412566442`*^9}, {3.727685703702217*^9, 3.727685704259094*^9}, {
   3.727685794931233*^9, 3.7276858638714542`*^9}, {3.727686124267973*^9, 
   3.7276861335544662`*^9}, {3.727687078113997*^9, 3.727687084559661*^9}, {
   3.727689410238901*^9, 3.727689459535637*^9}, {3.7276894931297083`*^9, 
   3.7276895400318403`*^9}, {3.7276897285521297`*^9, 3.7276897288068867`*^9}, 
   3.727690078949028*^9, {3.7276902852391663`*^9, 3.7276903046746273`*^9}, {
   3.7276907076839247`*^9, 3.727690714841157*^9}, {3.727690939309491*^9, 
   3.727690953929633*^9}, {3.727696088535955*^9, 3.727696088749699*^9}, {
   3.727757773268188*^9, 3.727757823701589*^9}, {3.727757881245099*^9, 
   3.727757882293539*^9}, {3.727759491482584*^9, 3.7277594916739388`*^9}, {
   3.727762364661405*^9, 3.727762432149131*^9}, {3.727762603039462*^9, 
   3.72776260343296*^9}, {3.727762648264073*^9, 3.727762650030171*^9}, {
   3.727762695521236*^9, 3.727762728128439*^9}, {3.727762778303732*^9, 
   3.727762875052683*^9}, {3.727765532008542*^9, 3.7277655322712183`*^9}, {
   3.7277659655348063`*^9, 3.727766006795479*^9}, {3.7280204370225573`*^9, 
   3.728020441664113*^9}, {3.735037878172394*^9, 3.735037885469323*^9}, {
   3.735037968871964*^9, 3.7350379903883123`*^9}, {3.735038122783827*^9, 
   3.735038137105399*^9}, {3.735038202779153*^9, 3.735038204660853*^9}, 
   3.7350382652299957`*^9},ExpressionUUID->"a18b805f-4b1b-4e00-90f1-\
b1325d826a21"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "See", " ", "relaxed", " ", "geometry", " ", "of", " ", "STM", " ", 
    "device", " ", "region"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"xyz", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"fn", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Data\>\"", ",", "\"\<Geometry\>\""}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"atoms", "=", 
     RowBox[{"xyz", "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", "1"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"g", "=", 
     RowBox[{"Gather", "[", "atoms", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noSpecies", "=", 
     RowBox[{"Length", "[", "g", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xyz2", "=", 
     RowBox[{"Table", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"ii", ",", 
         RowBox[{"Length", "@", "xyz"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"jj", ",", "5"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xyz2", "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", 
        RowBox[{"2", ";;", "5"}]}], "]"}], "]"}], "=", "xyz"}], ";"}], 
   "\[IndentingNewLine]", "xyz2", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cols", "=", 
     RowBox[{"0", 
      RowBox[{"Range", "[", "100", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"cols", "[", 
        RowBox[{"[", "ii", "]"}], "]"}], "=", 
       RowBox[{"ElementData", "[", 
        RowBox[{"ii", ",", "\"\<IconColor\>\""}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ii", ",", "40"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"xyz2", "[", 
         RowBox[{"[", "ii", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", 
       RowBox[{"cols", "[", 
        RowBox[{"[", 
         RowBox[{"Abs", "@", 
          RowBox[{
           RowBox[{"xyz2", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ii", ",", 
        RowBox[{"Length", "[", "xyz", "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"geom", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"xyz2", "[", 
          RowBox[{"[", 
           RowBox[{"ii", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"Sphere", "[", 
          RowBox[{
           RowBox[{"xyz2", "[", 
            RowBox[{"[", 
             RowBox[{"ii", ",", 
              RowBox[{"3", ";;", "5"}]}], "]"}], "]"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"xyz2", "[", 
                RowBox[{"[", "ii", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", 
             RowBox[{".4", 
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{"xyz2", "[", 
                 RowBox[{"[", 
                  RowBox[{"ii", ",", "2"}], "]"}], "]"}], "]"}], "^", 
               RowBox[{"(", 
                RowBox[{"1", "/", "3."}], ")"}]}]}], ",", "0.1"}], "]"}]}], 
          "]"}]}], "}"}], 
       StyleBox[",", "Input"], 
       StyleBox[
        RowBox[{"{", 
         RowBox[{"ii", ",", 
          RowBox[{"Length", "[", "xyz2", "]"}]}], "}"}], "Input"]}], 
      StyleBox["]", "Input"]}]}], 
    StyleBox[";", "Input"]}], 
   StyleBox["\[IndentingNewLine]", "Input"], 
   RowBox[{"plot", "=", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Specularity", "[", 
         RowBox[{"White", ",", "30"}], "]"}], ",", "geom"}], "}"}], ",", 
      RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
      RowBox[{"ViewPoint", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"5", ",", "50", ",", "3"}], "}"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "300"}], ",", 
      RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Epilog", "\[Rule]", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"\[CapitalDelta]z", ":", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"fn", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<Data\>\"", ",", "\"\<TipHeight\>\""}], "}"}]}], 
            "]"}], "\[CapitalARing]"}]}], ",", 
         RowBox[{"Scaled", "[", 
          RowBox[{"{", 
           RowBox[{".65", ",", "0.5"}], "}"}], "]"}]}], "]"}]}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.727175359815216*^9, 3.727175406197994*^9}, 
   3.727428041526083*^9, {3.727428117130785*^9, 3.727428128882504*^9}, 
   3.7274281601377573`*^9, {3.7274287117874813`*^9, 3.727428741196084*^9}, {
   3.727428819908403*^9, 3.727428840748027*^9}, {3.7274296236333838`*^9, 
   3.7274296470087957`*^9}, {3.727429762798831*^9, 3.727429802301654*^9}, {
   3.7274298426505957`*^9, 3.7274298805752153`*^9}, {3.7274299206723223`*^9, 
   3.7274299443098373`*^9}, {3.7274301375802727`*^9, 3.727430161332232*^9}, {
   3.7274302039851227`*^9, 3.727430441650003*^9}, {3.72743047894877*^9, 
   3.727430490735675*^9}, {3.727430529518821*^9, 3.727430532584447*^9}, {
   3.7274306111152353`*^9, 3.727430732556271*^9}, {3.727430849256484*^9, 
   3.7274309329317007`*^9}, {3.7274309664009647`*^9, 
   3.7274309791233273`*^9}, {3.7274310758753033`*^9, 3.727431086610326*^9}, {
   3.727431128860505*^9, 3.7274311478082314`*^9}, {3.727431204046712*^9, 
   3.727431205822959*^9}, {3.7274312555180902`*^9, 3.727431293220549*^9}, {
   3.727431338328751*^9, 3.727431358840123*^9}, {3.727431517813534*^9, 
   3.7274315333342733`*^9}, {3.727431628594019*^9, 3.727431769572812*^9}, {
   3.727431828443404*^9, 3.727431898105435*^9}, {3.727431930454965*^9, 
   3.727431983104093*^9}, {3.7274320371404057`*^9, 3.727432099410898*^9}, {
   3.727432155639748*^9, 3.727432431808098*^9}, {3.727432465910953*^9, 
   3.727432512345312*^9}, {3.7274329324184837`*^9, 3.7274329473318367`*^9}, {
   3.7274333115502253`*^9, 3.727433361243928*^9}, {3.727433391261382*^9, 
   3.727433465672604*^9}, {3.727436405958145*^9, 3.727436443883952*^9}, {
   3.7274367495471563`*^9, 3.7274367847146997`*^9}, {3.7274368158453493`*^9, 
   3.727436916834037*^9}, {3.727436956433104*^9, 3.727436967908334*^9}, {
   3.72743700304747*^9, 3.7274373157087708`*^9}, {3.727437378659185*^9, 
   3.727437401002112*^9}, {3.727515819771261*^9, 3.727515821177849*^9}, {
   3.727522625749494*^9, 3.7275226464412823`*^9}, {3.727524147032484*^9, 
   3.72752417692132*^9}, {3.72767914939332*^9, 3.727679178979075*^9}, {
   3.727684936574253*^9, 3.727685028182242*^9}, {3.727685089934124*^9, 
   3.7276850904933147`*^9}, 3.727685131756171*^9, 3.727685568443247*^9, 
   3.727685601626947*^9, {3.72775789664161*^9, 3.727757918288447*^9}, {
   3.727758049255643*^9, 3.727758151427297*^9}, {3.7277581980451508`*^9, 
   3.727758200449901*^9}, {3.7277585024936028`*^9, 3.727758552466798*^9}, {
   3.727759157268433*^9, 3.72775940774646*^9}, {3.727760244788917*^9, 
   3.7277602449116*^9}, {3.7277603137516937`*^9, 3.727760313862378*^9}, {
   3.727760348322057*^9, 3.7277603639217567`*^9}, {3.72776070755693*^9, 
   3.7277607724281607`*^9}, {3.7277608310377893`*^9, 3.727760840328051*^9}, {
   3.727760919858403*^9, 3.727761033289603*^9}, {3.727762908981607*^9, 
   3.727762950037224*^9}, {3.727766443505453*^9, 3.7277664625756187`*^9}, {
   3.727766566494289*^9, 3.727766580945389*^9}, {3.73503833809485*^9, 
   3.735038374585977*^9}, {3.735038412897942*^9, 3.735038420945009*^9}, {
   3.735038473666193*^9, 3.735038645240286*^9}, {3.7350386872312803`*^9, 
   3.735038747003934*^9}, {3.7350391166641693`*^9, 3.735039142309667*^9}, {
   3.735039178989484*^9, 3.73503927958396*^9}, {3.735039313071555*^9, 
   3.7350393370519333`*^9}},ExpressionUUID->"74c4c015-8bb4-4f13-81b2-\
43d073dd486d"]
},
WindowSize->{1920, 1025},
WindowMargins->{{0, Automatic}, {0, Automatic}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
ShowSelection->True,
FrontEndVersion->"11.2 for Linux x86 (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[400, 13, 9340, 181, 354, "Input",ExpressionUUID->"c3f8fcf5-276d-49fe-930e-80bf6021b3fb"],
Cell[9743, 196, 3685, 72, 124, "Input",ExpressionUUID->"d190b6bb-9a2c-4cf8-aa45-75db52447435"],
Cell[13431, 270, 6119, 142, 308, "Input",ExpressionUUID->"a18b805f-4b1b-4e00-90f1-b1325d826a21"],
Cell[19553, 414, 8147, 188, 335, "Input",ExpressionUUID->"74c4c015-8bb4-4f13-81b2-43d073dd486d"]
}
]
*)

